<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç€‘å¸ƒæµæµ‹è¯•é¡µé¢</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/style.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'xhs-red': '#FE2C55',
                        'beige': '#F5E6D3',
                        'beige-light': '#FAF5F0',
                        'beige-dark': '#D4B5A0'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-beige-light min-h-screen">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <nav class="sticky top-0 bg-white shadow-sm z-50 border-b border-gray-100">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <div class="text-xhs-red font-bold text-xl">ç€‘å¸ƒæµæµ‹è¯•</div>
            <div class="flex items-center space-x-3">
                <button id="addCards" class="px-4 py-2 bg-xhs-red text-white rounded-lg hover:bg-red-600 transition-colors">
                    æ·»åŠ å¡ç‰‡
                </button>
                <button id="refreshLayout" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                    é‡æ–°å¸ƒå±€
                </button>
                <button id="toggleTheme" class="p-2 rounded-full hover:bg-gray-100 transition-colors">
                    ğŸŒ™
                </button>
            </div>
        </div>
    </nav>

    <!-- ç€‘å¸ƒæµå®¹å™¨ -->
    <div class="waterfall-container" id="waterfallContainer">
        <!-- æµ‹è¯•å¡ç‰‡å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
    </div>

    <!-- æ€§èƒ½ç›‘æ§é¢æ¿ -->
    <div id="performancePanel" class="fixed bottom-4 right-4 bg-white p-4 rounded-lg shadow-lg text-sm">
        <div class="font-bold mb-2">æ€§èƒ½ç›‘æ§</div>
        <div>å¡ç‰‡æ•°é‡: <span id="cardCount">0</span></div>
        <div>åˆ—æ•°: <span id="columnCount">0</span></div>
        <div>å®¹å™¨é«˜åº¦: <span id="containerHeight">0</span>px</div>
        <div>å¸ƒå±€è€—æ—¶: <span id="layoutTime">0</span>ms</div>
    </div>

    <script>
        // æµ‹è¯•æ•°æ®
        const testNovels = [
            {
                id: 1,
                title: "éƒ½å¸‚éœ¸æ€»çš„å°å¨‡å¦»",
                summary: "å¥¹æ˜¯æ™®é€šçš„å¤§å­¦ç”Ÿï¼Œä»–æ˜¯å†·é…·çš„å•†ç•Œéœ¸æ€»ã€‚ä¸€æ¬¡æ„å¤–çš„ç›¸é‡ï¼Œè®©ä¸¤ä¸ªä¸åŒä¸–ç•Œçš„äººäº§ç”Ÿäº†äº¤é›†ã€‚ä»æœ€åˆçš„è¯¯ä¼šåˆ°åæ¥çš„ç›¸çŸ¥ç›¸çˆ±ï¼Œè¿™æ˜¯ä¸€ä¸ªå…³äºæˆé•¿ä¸çˆ±æƒ…çš„æ•…äº‹ã€‚",
                tags: ["#bg", "#éœ¸æ€»", "#éƒ½å¸‚", "#ç”œå® "],
                coverType: "text",
                coverData: { backgroundColor: "#FFE4E1", textColor: "#8B4513" },
                views: 15420,
                likes: 234,
                favorites: 89,
                publishTime: "2024-01-10T10:30:00Z"
            },
            {
                id: 2,
                title: "æ ¡å›­é‡Œçš„å°ç¾å¥½",
                summary: "é’æ˜¥æ ¡å›­é‡Œçš„çº¯çœŸçˆ±æƒ…ï¼Œå­¦éœ¸ç”·ä¸»å’Œå¯çˆ±å¥³ä¸»çš„ç”œèœœæ—¥å¸¸ã€‚ä»åŒæ¡Œåˆ°æ‹äººï¼Œè®°å½•ç€æœ€ç¾å¥½çš„é’æ˜¥æ—¶å…‰ã€‚",
                tags: ["#æ ¡å›­", "#å­¦éœ¸", "#é’æ˜¥", "#çº¯çˆ±"],
                coverType: "text",
                coverData: { backgroundColor: "#E6F3FF", textColor: "#4169E1" },
                views: 8930,
                likes: 156,
                favorites: 42,
                publishTime: "2024-01-12T14:20:00Z"
            },
            {
                id: 3,
                title: "é‡ç”Ÿä¹‹å•†ä¸šå¥³ç‹",
                summary: "é‡ç”Ÿå›åˆ°åå¹´å‰ï¼Œå¥¹å†³å®šç”¨å‰ä¸–çš„è®°å¿†æ”¹å†™äººç”Ÿã€‚ä»å°é€æ˜åˆ°å•†ä¸šå¥³ç‹ï¼Œè¿™æ˜¯ä¸€ä¸ªå…³äºé€†è¢­å’Œå¤ä»‡çš„æ•…äº‹ã€‚è¿™ä¸ªæ•…äº‹è®²è¿°äº†ä¸€ä¸ªç°ä»£å¥³æ€§å¦‚ä½•åœ¨å•†åœºä¸ŠæŠ«è†æ–©æ£˜ï¼Œæœ€ç»ˆæˆä¸ºå•†ä¸šå¸å›½çš„å¥³ç‹ã€‚",
                tags: ["#é‡ç”Ÿ", "#å¥³å¼º", "#å•†æˆ˜", "#å¤ä»‡"],
                coverType: "text",
                coverData: { backgroundColor: "#F0E68C", textColor: "#8B0000" },
                views: 23150,
                likes: 412,
                favorites: 167,
                publishTime: "2024-01-08T09:15:00Z"
            },
            {
                id: 4,
                title: "å¤ä»£ç‹çˆ·çš„ç°ä»£å¦ƒ",
                summary: "ä¸€åœºæ„å¤–è®©ç°ä»£å¥³å­©ç©¿è¶Šåˆ°å¤ä»£ï¼Œæˆä¸ºäº†å†·é¢ç‹çˆ·çš„ä¾§å¦ƒã€‚é¢å¯¹å¤æ‚çš„å®«å»·æ–—äº‰å’Œç‹çˆ·çš„å†·æ¼ ï¼Œå¥¹èƒ½å¦ç”¨ç°ä»£çš„æ™ºæ…§åœ¨å¤ä»£ç”Ÿå­˜ä¸‹å»ï¼Ÿ",
                tags: ["#ç©¿è¶Š", "#å¤ä»£", "#ç‹çˆ·", "#å®«æ–—"],
                coverType: "text",
                coverData: { backgroundColor: "#DDA0DD", textColor: "#4B0082" },
                views: 18750,
                likes: 298,
                favorites: 123,
                publishTime: "2024-01-15T16:45:00Z"
            },
            {
                id: 5,
                title: "æ˜Ÿé™…æŒ‡æŒ¥å®˜çš„åœ°çƒæ‹äºº",
                summary: "æœªæ¥ä¸–ç•Œï¼Œæ˜Ÿé™…æˆ˜äº‰ä¸€è§¦å³å‘ã€‚åœ°çƒå¥³å­©æ„å¤–æ•‘äº†å—ä¼¤çš„æ˜Ÿé™…æŒ‡æŒ¥å®˜ï¼Œä»æ­¤å·å…¥äº†ä¸€åœºè·¨è¶Šæ˜Ÿç³»çš„çˆ±æƒ…æ•…äº‹ã€‚ç§‘æŠ€ä¸çˆ±æƒ…çš„ç¢°æ’ï¼Œä¼šæ“¦å‡ºæ€æ ·çš„ç«èŠ±ï¼Ÿ",
                tags: ["#ç§‘å¹»", "#æ˜Ÿé™…", "#æœªæ¥", "#å¼‚èƒ½"],
                coverType: "text",
                coverData: { backgroundColor: "#00CED1", textColor: "#191970" },
                views: 12340,
                likes: 187,
                favorites: 76,
                publishTime: "2024-01-20T11:30:00Z"
            }
        ];

        // å…¨å±€å˜é‡
        let waterfallInstance = null;
        let cardIdCounter = 6;

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initTestPage();
        });

        function initTestPage() {
            // åˆå§‹åŒ–ç€‘å¸ƒæµ
            initWaterfall();
            
            // ç”Ÿæˆåˆå§‹å¡ç‰‡
            generateInitialCards();
            
            // ç»‘å®šäº‹ä»¶
            bindTestEvents();
            
            // å¯åŠ¨æ€§èƒ½ç›‘æ§
            startPerformanceMonitoring();
        }

        function initWaterfall() {
            const container = document.getElementById('waterfallContainer');
            if (!container) return;
            
            // é”€æ¯æ—§å®ä¾‹
            if (waterfallInstance) {
                waterfallInstance.destroy();
            }
            
            // åˆ›å»ºæ–°å®ä¾‹
            const screenWidth = window.innerWidth;
            let config = {
                gap: 16,
                minColumnWidth: 280,
                maxColumns: 4,
                padding: 20,
                animationDuration: 300,
                debounceDelay: 150
            };
            
            // å“åº”å¼é…ç½®
            if (screenWidth >= 1200) {
                config = { ...config, gap: 20, minColumnWidth: 300, maxColumns: 4, padding: 24 };
            } else if (screenWidth >= 1024) {
                config = { ...config, gap: 18, minColumnWidth: 280, maxColumns: 4, padding: 20 };
            } else if (screenWidth >= 768) {
                config = { ...config, gap: 16, minColumnWidth: 240, maxColumns: 3, padding: 18 };
            } else if (screenWidth >= 640) {
                config = { ...config, gap: 14, minColumnWidth: 200, maxColumns: 2, padding: 16 };
            } else {
                config = { ...config, gap: 12, minColumnWidth: 150, maxColumns: 2, padding: 12 };
            }
            
            waterfallInstance = new WaterfallLayout(container, config);
        }

        function generateInitialCards() {
            const container = document.getElementById('waterfallContainer');
            container.innerHTML = '';
            
            testNovels.forEach(novel => {
                const card = createTestCard(novel);
                container.appendChild(card);
            });
            
            // æ‰§è¡Œå¸ƒå±€
            if (waterfallInstance) {
                waterfallInstance.layout();
            }
        }

        function createTestCard(novel) {
            const card = document.createElement('div');
            card.className = 'novel-card bg-white rounded-xl shadow-sm hover:shadow-md transition-all duration-300 cursor-pointer';
            
            // ç”Ÿæˆå°é¢
            const coverHtml = generateTestCover(novel);
            
            // ç”Ÿæˆæ ‡ç­¾
            const tagsHtml = novel.tags.map(tag => 
                `<span class="inline-block px-2 py-1 text-xs bg-gray-100 text-gray-600 rounded-full mr-1 mb-1">${tag}</span>`
            ).join('');
            
            card.innerHTML = `
                ${coverHtml}
                <div class="card-content p-4">
                    <h3 class="font-semibold text-gray-800 mb-2">${novel.title}</h3>
                    <p class="text-sm text-gray-600 mb-3">${novel.summary}</p>
                    <div class="mb-3">
                        ${tagsHtml}
                    </div>
                    <div class="flex items-center justify-between text-xs text-gray-500">
                        <span>ğŸ‘ ${novel.views}</span>
                        <span>â¤ï¸ ${novel.likes}</span>
                        <span>â­ ${novel.favorites}</span>
                    </div>
                </div>
            `;
            
            return card;
        }

        function generateTestCover(novel) {
            const backgroundColor = novel.coverData?.backgroundColor || '#FFE4E1';
            const textColor = novel.coverData?.textColor || '#8B4513';
            
            // éšæœºé€‰æ‹©é«˜åº¦æ¯”ä¾‹
            const heightClasses = ['square', 'medium', 'tall'];
            const randomHeight = heightClasses[Math.floor(Math.random() * heightClasses.length)];

            return `
                <div class="novel-cover text-cover ${randomHeight}"
                     style="background-color: ${backgroundColor}; color: ${textColor};">
                    <h2 class="text-lg font-bold text-center">${novel.title}</h2>
                </div>
            `;
        }

        function bindTestEvents() {
            // æ·»åŠ å¡ç‰‡æŒ‰é’®
            document.getElementById('addCards').addEventListener('click', () => {
                addRandomCards(3);
            });
            
            // é‡æ–°å¸ƒå±€æŒ‰é’®
            document.getElementById('refreshLayout').addEventListener('click', () => {
                if (waterfallInstance) {
                    waterfallInstance.refresh();
                }
            });
            
            // ä¸»é¢˜åˆ‡æ¢æŒ‰é’®
            document.getElementById('toggleTheme').addEventListener('click', () => {
                document.body.classList.toggle('dark-theme');
            });
        }

        function addRandomCards(count) {
            const container = document.getElementById('waterfallContainer');
            
            for (let i = 0; i < count; i++) {
                const randomNovel = { ...testNovels[Math.floor(Math.random() * testNovels.length)] };
                randomNovel.id = cardIdCounter++;
                randomNovel.title = `${randomNovel.title} ${cardIdCounter}`;
                
                const card = createTestCard(randomNovel);
                container.appendChild(card);
            }
            
            // é‡æ–°å¸ƒå±€
            if (waterfallInstance) {
                waterfallInstance.layout();
            }
        }

        function startPerformanceMonitoring() {
            setInterval(() => {
                updatePerformancePanel();
            }, 1000);
        }

        function updatePerformancePanel() {
            const container = document.getElementById('waterfallContainer');
            const cards = container.querySelectorAll('.novel-card');
            
            document.getElementById('cardCount').textContent = cards.length;
            document.getElementById('columnCount').textContent = waterfallInstance ? waterfallInstance.columns : 0;
            document.getElementById('containerHeight').textContent = container.style.height.replace('px', '') || 0;
        }
    </script>
    
    <!-- å¼•å…¥ç€‘å¸ƒæµè„šæœ¬ -->
    <script src="js/main.js"></script>
</body>
</html>
