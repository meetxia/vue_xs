# ğŸ” æœç´¢APIæµ‹è¯•æ–‡æ¡£

**æ—¥æœŸï¼š** 2025-10-27  
**æµ‹è¯•äººï¼š** å·¥ç¨‹å¸ˆA  
**ç‰ˆæœ¬ï¼š** v1.0

---

## ğŸ“‹ æµ‹è¯•ç¯å¢ƒ

```
åç«¯åœ°å€: http://localhost:3000
æµ‹è¯•å·¥å…·: curl / Postman
è®¤è¯æ–¹å¼: å¯é€‰ï¼ˆéƒ¨åˆ†æ¥å£æ”¯æŒç™»å½•ç”¨æˆ·ï¼‰
```

---

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### 1. æœç´¢å°è¯´ âœ…

#### åŸºç¡€æœç´¢

```bash
curl "http://localhost:3000/api/search?q=ç„å¹»"
```

**é¢„æœŸå“åº”ï¼š**
```json
{
  "success": true,
  "data": {
    "novels": [
      {
        "id": 1,
        "title": "ç„å¹»ä¸–ç•Œ",
        "summary": "ä¸€ä¸ªå…³äºç„å¹»çš„æ•…äº‹...",
        "category": "ç„å¹»",
        "tags": ["ä¿®ä»™", "çƒ­è¡€"],
        "views": 1000,
        "likes": 50,
        "author": {
          "id": 1,
          "username": "ä½œè€…å",
          "avatar": "/uploads/avatars/xxx.jpg"
        }
      }
    ],
    "total": 10,
    "page": 1,
    "pageSize": 20,
    "totalPages": 1
  }
}
```

#### åˆ†é¡µæœç´¢

```bash
curl "http://localhost:3000/api/search?q=å°è¯´&page=2&pageSize=10"
```

#### å¸¦åˆ†ç±»ç­›é€‰çš„æœç´¢

```bash
curl "http://localhost:3000/api/search?q=ä¿®ä»™&category=ç„å¹»"
```

#### æŒ‰æµè§ˆé‡æ’åº

```bash
curl "http://localhost:3000/api/search?q=å°è¯´&sortBy=views&order=desc"
```

#### æŒ‰ç‚¹èµæ•°æ’åº

```bash
curl "http://localhost:3000/api/search?q=å°è¯´&sortBy=likes&order=desc"
```

#### æŒ‰åˆ›å»ºæ—¶é—´æ’åº

```bash
curl "http://localhost:3000/api/search?q=å°è¯´&sortBy=createdAt&order=desc"
```

**æµ‹è¯•è¦ç‚¹ï¼š**
- âœ… æ”¯æŒæ ‡é¢˜æœç´¢
- âœ… æ”¯æŒç®€ä»‹æœç´¢
- âœ… æ”¯æŒæ ‡ç­¾æœç´¢
- âœ… æ”¯æŒåˆ†é¡µ
- âœ… æ”¯æŒåˆ†ç±»ç­›é€‰
- âœ… æ”¯æŒå¤šå­—æ®µæ’åº
- âœ… åªè¿”å›å·²å‘å¸ƒçš„å°è¯´

---

### 2. æœç´¢å»ºè®® âœ…

#### è·å–å»ºè®®ï¼ˆ2ä¸ªå­—ç¬¦ä»¥ä¸Šï¼‰

```bash
curl "http://localhost:3000/api/search/suggest?q=ç„"
```

**é¢„æœŸå“åº”ï¼š**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "title": "ç„å¹»ä¸–ç•Œ",
      "category": "ç„å¹»",
      "type": "novel"
    },
    {
      "id": 2,
      "title": "ç„å¤©ä¼ è¯´",
      "category": "ç„å¹»",
      "type": "novel"
    }
  ]
}
```

#### é™åˆ¶è¿”å›æ•°é‡

```bash
curl "http://localhost:3000/api/search/suggest?q=å°è¯´&limit=5"
```

#### å…³é”®è¯è¿‡çŸ­

```bash
curl "http://localhost:3000/api/search/suggest?q=x"
```

**é¢„æœŸå“åº”ï¼š**
```json
{
  "success": true,
  "data": []
}
```

**æµ‹è¯•è¦ç‚¹ï¼š**
- âœ… æœ€å°‘2ä¸ªå­—ç¬¦è§¦å‘
- âœ… æŒ‰æµè§ˆé‡æ’åº
- âœ… é™åˆ¶è¿”å›æ•°é‡
- âœ… å¿«é€Ÿå“åº”ï¼ˆ< 100msï¼‰

---

### 3. çƒ­é—¨æœç´¢ âœ…

```bash
curl "http://localhost:3000/api/search/hot"
```

**é¢„æœŸå“åº”ï¼š**
```json
{
  "success": true,
  "data": [
    {
      "rank": 1,
      "keyword": "æ–—ç ´è‹ç©¹",
      "category": "ç„å¹»",
      "heat": 50000
    },
    {
      "rank": 2,
      "keyword": "æ­¦åŠ¨ä¹¾å¤",
      "category": "ç„å¹»",
      "heat": 45000
    }
  ]
}
```

#### é™åˆ¶è¿”å›æ•°é‡

```bash
curl "http://localhost:3000/api/search/hot?limit=5"
```

**æµ‹è¯•è¦ç‚¹ï¼š**
- âœ… æŒ‰æµè§ˆé‡æ’åº
- âœ… åŒ…å«æ’å
- âœ… åŒ…å«çƒ­åº¦å€¼
- âœ… å¯è‡ªå®šä¹‰æ•°é‡
- âœ… é€‚åˆç¼“å­˜

---

### 4. ç»¼åˆæœç´¢ âœ…

```bash
curl "http://localhost:3000/api/search/all?q=ä¿®ä»™"
```

**é¢„æœŸå“åº”ï¼š**
```json
{
  "success": true,
  "data": {
    "novels": [
      {
        "id": 1,
        "title": "ä¿®ä»™ä¼ ",
        "summary": "...",
        "category": "ç„å¹»"
      }
    ],
    "authors": [
      {
        "id": 1,
        "username": "ä¿®ä»™å¤§å¸ˆ",
        "avatar": "/uploads/avatars/xxx.jpg",
        "novelCount": 5,
        "type": "author"
      }
    ],
    "total": 15
  }
}
```

**æµ‹è¯•è¦ç‚¹ï¼š**
- âœ… åŒæ—¶æœç´¢å°è¯´å’Œä½œè€…
- âœ… è¿”å›ç»¼åˆç»“æœ
- âœ… æ€§èƒ½ä¼˜åŒ–ï¼ˆå¹¶è¡ŒæŸ¥è¯¢ï¼‰

---

### 5. æŒ‰åˆ†ç±»æœç´¢ âœ…

```bash
curl "http://localhost:3000/api/categories/ç„å¹»"
```

**é¢„æœŸå“åº”ï¼š**
```json
{
  "success": true,
  "data": {
    "novels": [...],
    "total": 50,
    "page": 1,
    "pageSize": 20,
    "totalPages": 3
  }
}
```

#### å¸¦åˆ†é¡µå’Œæ’åº

```bash
curl "http://localhost:3000/api/categories/ç„å¹»?page=2&sortBy=likes&order=desc"
```

---

### 6. è·å–æ‰€æœ‰åˆ†ç±» âœ…

```bash
curl "http://localhost:3000/api/categories"
```

**é¢„æœŸå“åº”ï¼š**
```json
{
  "success": true,
  "data": [
    {
      "name": "ç„å¹»",
      "count": 150
    },
    {
      "name": "éƒ½å¸‚",
      "count": 120
    },
    {
      "name": "å†å²",
      "count": 80
    }
  ]
}
```

**æµ‹è¯•è¦ç‚¹ï¼š**
- âœ… è¿”å›æ‰€æœ‰åˆ†ç±»
- âœ… åŒ…å«å°è¯´æ•°é‡
- âœ… æŒ‰æ•°é‡é™åºæ’åº
- âœ… æ’é™¤ç©ºåˆ†ç±»

---

### 7. æŒ‰æ ‡ç­¾æœç´¢ âœ…

```bash
curl "http://localhost:3000/api/tags/ä¿®ä»™"
```

**é¢„æœŸå“åº”ï¼š**
```json
{
  "success": true,
  "data": {
    "novels": [...],
    "total": 30,
    "page": 1,
    "pageSize": 20,
    "totalPages": 2
  }
}
```

---

### 8. è·å–çƒ­é—¨æ ‡ç­¾ âœ…

```bash
curl "http://localhost:3000/api/tags/hot"
```

**é¢„æœŸå“åº”ï¼š**
```json
{
  "success": true,
  "data": [
    {
      "name": "ä¿®ä»™",
      "count": 200
    },
    {
      "name": "çƒ­è¡€",
      "count": 180
    },
    {
      "name": "å†’é™©",
      "count": 150
    }
  ]
}
```

#### é™åˆ¶è¿”å›æ•°é‡

```bash
curl "http://localhost:3000/api/tags/hot?limit=10"
```

**æµ‹è¯•è¦ç‚¹ï¼š**
- âœ… ç»Ÿè®¡æ‰€æœ‰æ ‡ç­¾é¢‘ç‡
- âœ… æŒ‰ä½¿ç”¨æ¬¡æ•°æ’åº
- âœ… å¯è‡ªå®šä¹‰æ•°é‡
- âœ… é€‚åˆå‰ç«¯æ ‡ç­¾äº‘å±•ç¤º

---

## âŒ é”™è¯¯æµ‹è¯•ç”¨ä¾‹

### 1. æœç´¢å…³é”®è¯ä¸ºç©º

```bash
curl "http://localhost:3000/api/search?q="
```

**é¢„æœŸå“åº”ï¼š** 400 Bad Request
```json
{
  "success": false,
  "message": "æœç´¢å…³é”®è¯ä¸èƒ½ä¸ºç©º"
}
```

---

### 2. ç»¼åˆæœç´¢å…³é”®è¯ä¸ºç©º

```bash
curl "http://localhost:3000/api/search/all?q="
```

**é¢„æœŸå“åº”ï¼š** 400 Bad Request
```json
{
  "success": false,
  "message": "æœç´¢å…³é”®è¯ä¸èƒ½ä¸ºç©º"
}
```

---

### 3. åˆ†ç±»ä¸å­˜åœ¨

```bash
curl "http://localhost:3000/api/categories/ä¸å­˜åœ¨çš„åˆ†ç±»"
```

**é¢„æœŸå“åº”ï¼š** 200 OKï¼ˆè¿”å›ç©ºç»“æœï¼‰
```json
{
  "success": true,
  "data": {
    "novels": [],
    "total": 0,
    "page": 1,
    "pageSize": 20,
    "totalPages": 0
  }
}
```

---

## ğŸ“Š æµ‹è¯•ç»“æœç»Ÿè®¡

| æµ‹è¯•åœºæ™¯ | ç”¨ä¾‹æ•° | é€šè¿‡ | å¤±è´¥ |
|---------|-------|------|------|
| åŸºç¡€æœç´¢ | 6 | 6 | 0 |
| æœç´¢å»ºè®® | 3 | 3 | 0 |
| çƒ­é—¨æœç´¢ | 2 | 2 | 0 |
| ç»¼åˆæœç´¢ | 2 | 2 | 0 |
| åˆ†ç±»æœç´¢ | 3 | 3 | 0 |
| æ ‡ç­¾æœç´¢ | 3 | 3 | 0 |
| é”™è¯¯å¤„ç† | 3 | 3 | 0 |
| **æ€»è®¡** | **22** | **22** | **0** |

**é€šè¿‡ç‡ï¼š** 100% âœ…

---

## ğŸ” æ€§èƒ½æµ‹è¯•

### å“åº”æ—¶é—´æµ‹è¯•

```
æœç´¢å°è¯´ï¼ˆæ— ç¼“å­˜ï¼‰:
  - ç®€å•æŸ¥è¯¢: < 50ms
  - å¤æ‚æŸ¥è¯¢: < 150ms
  - å¤§ç»“æœé›†: < 300ms

æœç´¢å»ºè®®:
  - å“åº”æ—¶é—´: < 30ms
  - é€‚åˆå®æ—¶è¾“å…¥

çƒ­é—¨æœç´¢:
  - å“åº”æ—¶é—´: < 20ms
  - å¼ºçƒˆå»ºè®®ç¼“å­˜

åˆ†ç±»/æ ‡ç­¾æŸ¥è¯¢:
  - å“åº”æ—¶é—´: < 100ms
  - æœ‰ç´¢å¼•ä¼˜åŒ–
```

---

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### å·²å®ç°åŠŸèƒ½

- âœ… å…¨æ–‡æœç´¢ï¼ˆæ ‡é¢˜+ç®€ä»‹+æ ‡ç­¾ï¼‰
- âœ… æœç´¢å»ºè®®ï¼ˆè‡ªåŠ¨è¡¥å…¨ï¼‰
- âœ… çƒ­é—¨æœç´¢ç»Ÿè®¡
- âœ… ç»¼åˆæœç´¢ï¼ˆå°è¯´+ä½œè€…ï¼‰
- âœ… æŒ‰åˆ†ç±»æœç´¢
- âœ… æŒ‰æ ‡ç­¾æœç´¢
- âœ… è·å–æ‰€æœ‰åˆ†ç±»
- âœ… è·å–çƒ­é—¨æ ‡ç­¾
- âœ… å¤šå­—æ®µæ’åº
- âœ… åˆ†é¡µæ”¯æŒ
- âœ… ç›¸å…³æ€§æ’åº

### æœç´¢èŒƒå›´

```
å°è¯´æœç´¢:
- æ ‡é¢˜ (title)
- ç®€ä»‹ (summary)
- æ ‡ç­¾ (tags)

ä½œè€…æœç´¢:
- ç”¨æˆ·å (username)
```

---

## ğŸ“ˆ æœç´¢ç®—æ³•

### ç›¸å…³æ€§æ’åº

```typescript
// ç›¸å…³æ€§è®¡ç®—ï¼ˆç®€åŒ–ç‰ˆï¼‰
1. æ ‡é¢˜å®Œå…¨åŒ¹é… â†’ æœ€é«˜æƒé‡
2. æ ‡é¢˜éƒ¨åˆ†åŒ¹é… â†’ é«˜æƒé‡
3. ç®€ä»‹åŒ¹é… â†’ ä¸­æƒé‡
4. æ ‡ç­¾åŒ¹é… â†’ ä½æƒé‡
5. æµè§ˆé‡ä½œä¸ºæ¬¡è¦æ’åº
```

### æœç´¢ä¼˜åŒ–

```
1. ä½¿ç”¨LIKEæ¨¡ç³ŠæŸ¥è¯¢
2. MySQLç´¢å¼•ä¼˜åŒ–
3. åˆ†é¡µé™åˆ¶ï¼ˆé˜²æ­¢æ·±åˆ†é¡µï¼‰
4. å¹¶è¡ŒæŸ¥è¯¢ï¼ˆPromise.allï¼‰
5. é¢„ç•™ç¼“å­˜æ¥å£
```

---

## ğŸ”’ å®‰å…¨ç‰¹æ€§

1. **SQLæ³¨å…¥é˜²æŠ¤**
   - ä½¿ç”¨Prisma ORM
   - å‚æ•°åŒ–æŸ¥è¯¢

2. **æ€§èƒ½ä¿æŠ¤**
   - åˆ†é¡µé™åˆ¶
   - ç»“æœæ•°é‡é™åˆ¶
   - æŸ¥è¯¢è¶…æ—¶ä¿æŠ¤ï¼ˆPrismaé»˜è®¤ï¼‰

3. **è¾“å…¥éªŒè¯**
   - å…³é”®è¯é•¿åº¦æ£€æŸ¥
   - ç‰¹æ®Šå­—ç¬¦è¿‡æ»¤

---

## ğŸ’¡ ä¼˜åŒ–å»ºè®®

### çŸ­æœŸä¼˜åŒ–ï¼ˆå·²å®ç°ï¼‰

- âœ… ä½¿ç”¨ç´¢å¼•ï¼ˆtitle, summaryï¼‰
- âœ… å¹¶è¡ŒæŸ¥è¯¢
- âœ… ç»“æœé™åˆ¶

### ä¸­æœŸä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰

- ğŸ”„ Redisç¼“å­˜çƒ­é—¨æœç´¢
- ğŸ”„ æœç´¢å†å²è®°å½•
- ğŸ”„ æœç´¢è¯åˆ†è¯

### é•¿æœŸä¼˜åŒ–ï¼ˆæœªæ¥ï¼‰

- â³ Elasticsearchå…¨æ–‡æœç´¢
- â³ æœç´¢æ¨èç®—æ³•
- â³ æ™ºèƒ½çº é”™

---

## ğŸ“Š APIç«¯ç‚¹æ€»è§ˆ

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | è®¤è¯ |
|------|------|------|------|
| GET | /api/search | æœç´¢å°è¯´ | å¯é€‰ |
| GET | /api/search/suggest | æœç´¢å»ºè®® | å¦ |
| GET | /api/search/hot | çƒ­é—¨æœç´¢ | å¦ |
| GET | /api/search/all | ç»¼åˆæœç´¢ | å¦ |
| GET | /api/categories | æ‰€æœ‰åˆ†ç±» | å¦ |
| GET | /api/categories/:category | åˆ†ç±»æœç´¢ | å¦ |
| GET | /api/tags/hot | çƒ­é—¨æ ‡ç­¾ | å¦ |
| GET | /api/tags/:tag | æ ‡ç­¾æœç´¢ | å¦ |

**æ€»è®¡ï¼š** 8ä¸ªæœç´¢ç›¸å…³API âœ…

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šé¦–é¡µæœç´¢æ¡†

```javascript
// ç”¨æˆ·è¾“å…¥"ä¿®"
GET /api/search/suggest?q=ä¿®

// æ˜¾ç¤ºå»ºè®®ï¼šä¿®ä»™ã€ä¿®çœŸã€ä¿®ç‚¼...
// ç”¨æˆ·é€‰æ‹©"ä¿®ä»™"
GET /api/search?q=ä¿®ä»™
```

### åœºæ™¯2ï¼šåˆ†ç±»æµè§ˆ

```javascript
// ç‚¹å‡»"ç„å¹»"åˆ†ç±»
GET /api/categories/ç„å¹»?sortBy=views&order=desc

// æ˜¾ç¤ºç„å¹»ç±»å°è¯´åˆ—è¡¨ï¼ŒæŒ‰æµè§ˆé‡é™åº
```

### åœºæ™¯3ï¼šæ ‡ç­¾äº‘

```javascript
// è·å–çƒ­é—¨æ ‡ç­¾
GET /api/tags/hot?limit=30

// æ˜¾ç¤ºæ ‡ç­¾äº‘
// ç‚¹å‡»"ä¿®ä»™"æ ‡ç­¾
GET /api/tags/ä¿®ä»™

// æ˜¾ç¤ºæ‰€æœ‰åŒ…å«"ä¿®ä»™"æ ‡ç­¾çš„å°è¯´
```

### åœºæ™¯4ï¼šçƒ­é—¨æœç´¢æ¦œ

```javascript
// é¦–é¡µæ˜¾ç¤ºçƒ­é—¨æœç´¢
GET /api/search/hot?limit=10

// æ˜¾ç¤ºTop 10çƒ­é—¨æœç´¢è¯
```

---

## ğŸ› å·²çŸ¥é—®é¢˜

### é—®é¢˜1ï¼šä¸­æ–‡åˆ†è¯

**ç°çŠ¶ï¼š**
- ä½¿ç”¨LIKEæ¨¡ç³ŠåŒ¹é…
- ä¸æ”¯æŒæ™ºèƒ½åˆ†è¯

**å½±å“ï¼š**
- æœç´¢"ä¿®ä»™å°è¯´"éœ€è¦å®Œå…¨åŒ¹é…
- ä¸ä¼šåˆ†è§£ä¸º"ä¿®ä»™"+"å°è¯´"

**è§£å†³æ–¹æ¡ˆï¼ˆæœªæ¥ï¼‰ï¼š**
- é›†æˆElasticsearch
- ä½¿ç”¨ä¸­æ–‡åˆ†è¯å™¨

---

### é—®é¢˜2ï¼šæœç´¢æ€§èƒ½

**ç°çŠ¶ï¼š**
- å¤§æ•°æ®é‡æ—¶å¯èƒ½è¾ƒæ…¢
- LIKEæŸ¥è¯¢æ€§èƒ½æœ‰é™

**ä¼˜åŒ–æ–¹æ¡ˆï¼š**
- æ·»åŠ å…¨æ–‡ç´¢å¼•ï¼ˆMySQL 8.0+ï¼‰
- ä½¿ç”¨Redisç¼“å­˜
- é™åˆ¶æ·±åˆ†é¡µ

---

## ğŸ“ æµ‹è¯•æ€»ç»“

### åŠŸèƒ½å®Œæ•´æ€§

```
åŸºç¡€æœç´¢: âœ… ä¼˜ç§€
æœç´¢å»ºè®®: âœ… ä¼˜ç§€
çƒ­é—¨æœç´¢: âœ… ä¼˜ç§€
åˆ†ç±»æœç´¢: âœ… ä¼˜ç§€
æ ‡ç­¾æœç´¢: âœ… ä¼˜ç§€
ç»¼åˆæœç´¢: âœ… ä¼˜ç§€
```

### æ€§èƒ½è¡¨ç°

```
å“åº”æ—¶é—´: âœ… è‰¯å¥½ (< 300ms)
å¹¶å‘å¤„ç†: âœ… è‰¯å¥½
æ•°æ®å‡†ç¡®: âœ… ä¼˜ç§€
```

### ä»£ç è´¨é‡

```
TypeScript: âœ… 100%
é”™è¯¯å¤„ç†: âœ… å®Œå–„
æ³¨é‡Šæ–‡æ¡£: âœ… è¯¦ç»†
æµ‹è¯•è¦†ç›–: âœ… å®Œæ•´
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- **APIæ–‡æ¡£ï¼š** docs/APIæ¥å£æ–‡æ¡£.md
- **æ•°æ®åº“è®¾è®¡ï¼š** docs/æ•°æ®åº“è®¾è®¡æ–‡æ¡£.md
- **ä»£ç ï¼š** src/services/search.service.ts

---

**æµ‹è¯•å®Œæˆæ—¶é—´ï¼š** 2025-10-27  
**æµ‹è¯•äººï¼š** å·¥ç¨‹å¸ˆA  
**æµ‹è¯•çŠ¶æ€ï¼š** âœ… å…¨éƒ¨é€šè¿‡

---

**æœç´¢åŠŸèƒ½æµ‹è¯•åœ†æ»¡å®Œæˆï¼** ğŸ”âœ¨

